# Ydant Documentation Guide

## ドキュメントの哲学

### 原則

1. **ドキュメントは仕様の一部である**
   - README に書かれた API 仕様はテストでカバーされるべき（TESTING.md 参照）
   - ドキュメントと実装が乖離したら、どちらかを修正する
   - 「README が正しければ実装も正しい」という信頼性を維持する

2. **情報の一次情報源を一つにする**
   - 同じ情報を複数箇所に書かない
   - 参照先がある場合はリンクで誘導する
   - 重複が発生したら、一次情報源を決めて他を参照に置き換える

3. **読者を意識する**
   - 各ドキュメントには想定読者がいる。その読者が必要な情報だけを置く
   - 「初見ユーザー」と「コントリビューター」では必要な情報が異なる

4. **方針自体が変化する**
   - このドキュメントに書かれた方針は「現時点のベスト」であり、固定的・絶対的なものではない
   - プロジェクトの成長、周辺事情の変化に応じて方針も変わる
   - 方針に合わせてドキュメントを直すだけでなく、実践を通じて方針を見直すことも同等に重要
   - 「なぜこの方針か」の理由が失われていたら、方針の見直し時期のサインである

---

## ドキュメントの配置

### ファイルと役割

| ファイル                     | 役割                                         | 想定読者           |
| ---------------------------- | -------------------------------------------- | ------------------ |
| `README.md` / `README.ja.md` | プロジェクト概要、機能一覧                   | 初見ユーザー       |
| `packages/*/README.md`       | パッケージの API 仕様                        | ライブラリ利用者   |
| `examples/*/README.md`       | 実装パターン、躓きポイント                   | 学習者             |
| `docs/CONVENTIONS.md`        | 命名規則、型の使い分け、コーディングパターン | コントリビューター |
| `docs/TESTING.md`            | テスト方針、TDD の適用、テストの書き方       | テスト作成者       |
| `docs/DOCUMENTATION.md`      | ドキュメント方針（このファイル）             | ドキュメント作成者 |
| `docs/PROJECT_KNOWLEDGE.md`  | 設計哲学、開発履歴、学んだ教訓               | 長期メンテナー     |
| `CLAUDE.md`                  | 開発ガイドの入口、コマンド一覧               | 開発者全般         |

### 情報の種類と配置先

| 情報                                           | 配置先                       |
| ---------------------------------------------- | ---------------------------- |
| API 仕様、型定義、関数シグネチャ               | `packages/*/README.md`       |
| 使用例、機能一覧、プロジェクト概要             | `README.md` / `README.ja.md` |
| 実装パターン、躓きポイント、ベストプラクティス | `examples/*/README.md`       |
| 命名規則、コーディングパターン                 | `docs/CONVENTIONS.md`        |
| テスト方針、テストの書き方                     | `docs/TESTING.md`            |
| 設計判断の経緯、なぜこうなったか               | `docs/PROJECT_KNOWLEDGE.md`  |
| 開発コマンド、ビルド手順                       | `CLAUDE.md`                  |

### 迷ったときの判断基準

- **「何ができるか」** → パッケージ README
- **「どう使うか」の具体例** → showcase README
- **「どう書くか」のルール** → CONVENTIONS.md
- **「なぜこうなったか」** → PROJECT_KNOWLEDGE.md

---

## パッケージ README のテンプレート

全パッケージで以下の構造に従う。

### 必須セクション

```markdown
# @ydant/<name>

<1行の説明文（英語）>

## Installation

\`\`\`bash
pnpm add @ydant/<name>
\`\`\`

## Usage

<基本的な使用例。コードブロック付き。>
<複数のユースケースがある場合は ### サブセクションで分ける>

## API

<公開 API の詳細>
<関数シグネチャ → インターフェース定義 → 説明 の順>
```

### オプションセクション

```markdown
## Philosophy

<設計思想。基盤パッケージ（core, base）のみ>

## Module Structure

<ファイル構成。複数ファイルで構成されるパッケージのみ>
<箇条書きで「ファイル名 - 役割」の形式>
```

### セクション順序

1. タイトル + 1行説明
2. Philosophy（あれば）
3. Installation
4. Usage
5. API
6. Module Structure（あれば）

### API セクションの書き方

```markdown
### <関数名/概念名>

\`\`\`typescript
function <name><T>(args): ReturnType;

interface <Name><T> {
// メソッドとプロパティ
}
\`\`\`

<説明文。パラメータの意味、戻り値、副作用。>
<必要に応じてコード例を追加。>
```

表形式は型やユーティリティの一覧に使用:

```markdown
| Type     | Description                  |
| -------- | ---------------------------- |
| `Render` | コンポーネント関数の戻り値型 |
```

---

## Showcase README のテンプレート

全 showcase で以下の構造に従う。日本語で記述する。

```markdown
# Showcase N: <名前>

<1行の説明文>

## 機能

- <箇条書きで3〜4項目>

## 実装のポイント

### <ポイント1のタイトル>

<説明とコード例>

### <ポイント2のタイトル>

<説明とコード例>
<✅/❌ 形式でベストプラクティスを示すのも可>

## 実行

\`\`\`bash
pnpm run dev
\`\`\`
```

### 「実装のポイント」の書き方

- **躓きやすい箇所** を優先する（API の使い方は packages README に委ねる）
- **コード例は最小限** に。全体のコードではなく、ポイントになる部分だけ
- **なぜそう書くか** を説明する。「こう書く」だけでは不十分

---

## ルート README の方針

### 日英同期

- `README.md`（英語）と `README.ja.md`（日本語）は **内容を完全に一致** させる
- セクション構成、コード例、順序を揃える
- 一方を更新したら必ず他方も更新する

### パッケージ / showcase README の言語

- パッケージ README: **英語** — ライブラリ利用者向け
- Showcase README: **日本語** — 開発チーム内の知見共有

---

## ドキュメント更新のタイミング

### 必ず更新するタイミング

| トリガー                             | 更新対象                          |
| ------------------------------------ | --------------------------------- |
| 公開 API の追加・変更・削除          | パッケージ README                 |
| パッケージの新規追加                 | パッケージ README + ルート README |
| showcase の新規追加                  | showcase README + ルート README   |
| 命名規則・コーディングパターンの変更 | CONVENTIONS.md                    |
| テスト方針の変更                     | TESTING.md                        |
| 設計上の重要な判断                   | PROJECT_KNOWLEDGE.md              |

### 更新を検討するタイミング

| トリガー                         | 検討対象                                         |
| -------------------------------- | ------------------------------------------------ |
| バグ修正で「躓きポイント」が判明 | 該当 showcase README への追記                    |
| 実装パターンの発見               | 該当 showcase README または PROJECT_KNOWLEDGE.md |
| 開発コマンドの変更               | CLAUDE.md                                        |

### 更新しなくてよいもの

- 内部実装の変更（公開 API に影響しない場合）
- テストコードの追加（TESTING.md の方針に影響しない場合）
- リファクタリング（外部仕様に影響しない場合）

---

## JSDoc の方針

### 必須: 公開 API

`packages/*/src/` の公開関数・インターフェースには JSDoc を付ける:

````typescript
/**
 * Signal を作成する
 *
 * @param initialValue - 初期値
 * @returns Signal オブジェクト
 *
 * @example
 * ```typescript
 * const count = signal(0);
 * count.set(5);
 * ```
 */
export function signal<T>(initialValue: T): Signal<T> {
````

必須タグ:

- `@param` — パラメータの説明
- `@returns` — 戻り値の説明

推奨タグ:

- `@example` — 使用例

### 不要: 内部実装

- 内部ヘルパー関数
- テストコード
- 自明な getter/setter

### 言語

JSDoc のテキストは **日本語** で記述する（コード例は言語非依存）。

---

## 重複排除の原則

### 一次情報源を守る

各情報には「一次情報源」が一つだけある。他の場所から参照する場合はリンクを使う:

```markdown
テスト方針は **[docs/TESTING.md](TESTING.md)** を参照。
```

### 重複を発見したら

1. どちらが一次情報源かを判断する
2. 一次情報源側を正とし、他方をリンクに置き換える
3. 判断に迷ったら、より詳細な記述がある方を一次情報源とする

### 許容される重複

- **CLAUDE.md のファイル一覧テーブル**: 開発ガイドの入口として、ファイル名と簡潔な説明を持つ。詳細はリンク先に委ねる
- **ルート README の機能一覧**: プロジェクト概要として簡潔にまとめる。詳細はパッケージ README に委ねる

---

## docs/ ディレクトリの管理

### 新しいドキュメントを追加するとき

1. 既存ドキュメントのどこにも該当しない情報か確認する
2. 独立したトピックとして十分なボリュームがあるか確認する
3. 追加したら CLAUDE.md の Documentation Structure テーブルに反映する
4. 必要に応じて DOCUMENTATION.md の「ファイルと役割」テーブルも更新する

### ドキュメントを削除するとき

1. 他のドキュメントからの参照がないか確認する
2. 情報が不要になったのか、他に統合すべきかを判断する
3. CLAUDE.md の Documentation Structure テーブルから削除する

---

## 方針のメンテナンス

### この方針書の位置づけ

このドキュメント自体が「原則 4: 方針自体が変化する」の対象である。
ここに書かれたテンプレート、配置ルール、更新タイミングは **現時点で有効な方針** であり、プロジェクトの変化に応じて見直される。

### 方針を見直すタイミング

| シグナル                                                 | 意味                                                     |
| -------------------------------------------------------- | -------------------------------------------------------- |
| テンプレートに合わないドキュメントが自然に生まれる       | テンプレートが実態に追いついていない可能性               |
| 配置ルールで迷う情報が繰り返し発生する                   | 配置の基準が不十分、または新しい種類の情報が生まれている |
| レビューで同じ指摘が何度も出る                           | 方針の記述が不明確、または方針自体が不適切               |
| 新しいパッケージや showcase が既存のパターンに収まらない | プロジェクトの成長に方針が追いついていない               |

### 見直しの進め方

1. **摩擦を記録する** — テンプレートや配置ルールが合わないと感じた場面を具体的に残す
2. **理由を問う** — 現在の方針がそうなっている理由を確認する。理由が今も有効か判断する
3. **変更を提案する** — 方針の変更案を具体的に示し、影響範囲を確認する
4. **反映する** — 方針を変更したら、既存ドキュメントとの整合性を確認する

### 方針変更の粒度

- **テンプレートの微調整**（セクション追加、順序変更）: 実態に合わせて随時
- **配置ルールの変更**（情報の一次情報源の移動）: 影響する既存ドキュメントも合わせて更新
- **哲学・原則の変更**: 他の方針ドキュメント（TESTING.md, CONVENTIONS.md）への波及も検討
